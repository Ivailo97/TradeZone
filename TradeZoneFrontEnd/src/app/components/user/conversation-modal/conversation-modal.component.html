<div class="modal fade right" id="chatModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">

    <div class="modal-dialog modal-side modal-bottom-left" role="document">

        <div class="modal-content" style="background-color: blueviolet;">

            <div class="container-fluid">
                <div class="row justify-content-center">

                    <div class="card">
                        <div class="card-header msg_head">
                            <div class="d-flex bd-highlight">
                                <div class="img_cont">
                                    <img src="{{receiver?.photoUrl}}" class="rounded-circle user_img">
                                    <span class="online_icon" [ngClass]="receiver?.connected ? '':'offline'"></span>
                                </div>
                                <div class="user_info">
                                    <span>{{receiver?.firstName +' '+ receiver?.lastName}}</span>
                                    <p>{{receiver?.connected ? 'Online':'Offline'}}</p>
                                </div>
                            </div>
                            <span id="action_menu_btn" (click)="toggleMenu()"><i class="fas fa-ellipsis-v"></i></span>

                            <div class="action_menu" *ngIf="showMenu">
                                <ul>
                                    <li><i class="fas fa-user-circle"></i> View profile</li>
                                    <li><i class="fas fa-users"></i> Add to close friends</li>
                                    <li><i class="fas fa-plus"></i> Add to group</li>
                                    <li><i class="fas fa-ban"></i> Block</li>
                                </ul>
                            </div>

                        </div>
                        <div id="msg-container" class="card-body msg_card_body">

                            <div class="row d-flex mb-4" *ngFor="let message of filteredMessages" [ngClass]="(message.sender==username)?'justify-content-start':'justify-content-end'">
                                <div *ngIf="message.sender === username; then senderTemplate else receiverTemplate">
                                    Here is never showing
                                </div>

                                <ng-template #senderTemplate>
                                    <div class="img_cont_msg">
                                        <img src="{{message.senderAvatarUrl}}" class="rounded-circle user_img_msg">
                                    </div>
                                    <div class="row msg_cotainer">
                                        {{message.content}}
                                        <div class="time_info mt-2 row">

                                            <div class="col-md-4">
                                            </div>

                                            <div *ngIf="message.readDate" matTooltip="Read: {{ message.readDate | date:'shortTime'}} " class="col-md-2">
                                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64" width="15" height="15"><g id="Layer_31" data-name="Layer 31"><path d="M59.15,31.38h0L45.6,10.65a3.59,3.59,0,0,0-6.47,1,3.54,3.54,0,0,0,.59,3.11l1,1.39,1.6-1.2-1-1.39a1.56,1.56,0,0,1-.26-1.37,1.58,1.58,0,0,1,2.86-.43L54.7,28.22A14,14,0,0,0,35.59,37H28.41A14,14,0,0,0,9.3,28.22L20.08,11.73a1.58,1.58,0,0,1,2.86.43,1.56,1.56,0,0,1-.26,1.37l-1,1.39,1.6,1.2,1-1.39a3.58,3.58,0,1,0-5.87-4.09L4.85,31.38h0A14,14,0,1,0,28.41,45h7.18A14,14,0,1,0,59.15,31.38ZM15,53A12,12,0,1,1,27,41,12,12,0,0,1,15,53ZM28.84,43a12.58,12.58,0,0,0,0-4h6.32a12.58,12.58,0,0,0,0,4ZM49,53A12,12,0,1,1,61,41,12,12,0,0,1,49,53Z"/><path d="M49,31A10,10,0,1,0,59,41,10,10,0,0,0,49,31ZM42.27,45.31a8,8,0,0,1-1-2.19l9.83-9.83a8,8,0,0,1,2.19,1ZM48.56,33,41,40.56A8,8,0,0,1,48.56,33ZM49,49a8,8,0,0,1-5.44-2.15L54.85,35.56a8,8,0,0,1,1.3,1.87l-4.86,4.86,1.42,1.42,4.15-4.16A7.67,7.67,0,0,1,57,41,8,8,0,0,1,49,49Z"/><path d="M15,31A10,10,0,1,0,25,41,10,10,0,0,0,15,31ZM8.27,45.31a8,8,0,0,1-1-2.19l9.83-9.83a8,8,0,0,1,2.19,1ZM14.56,33,7,40.56A8,8,0,0,1,14.56,33ZM15,49a8,8,0,0,1-5.44-2.15L20.85,35.56a8,8,0,0,1,1.3,1.87l-4.86,4.86,1.42,1.42,4.15-4.16A7.67,7.67,0,0,1,23,41,8,8,0,0,1,15,49Z"/></g></svg>
                                            </div>

                                            <div matTooltip="Sent: {{message.timestamp | date:'shortTime'}}" class="col-md-2">
                                                <svg id="Capa_1" enable-background="new 0 0 512 512" height="15" viewBox="0 0 512 512" width="15" xmlns="http://www.w3.org/2000/svg"><path d="m478.5 83.5h-385c-18.472 0-33.5 15.028-33.5 33.5v71.5h-52.5c-4.142 0-7.5 3.357-7.5 7.5s3.358 7.5 7.5 7.5h90c4.142 0 7.5-3.357 7.5-7.5s-3.358-7.5-7.5-7.5h-22.5v-71.5c0-2.342.455-4.576 1.253-6.64l145.64 145.64-145.64 145.64c-.798-2.064-1.253-4.298-1.253-6.64v-49c0-4.143-3.358-7.5-7.5-7.5s-7.5 3.357-7.5 7.5v49c0 18.472 15.028 33.5 33.5 33.5h385c18.472 0 33.5-15.028 33.5-33.5v-278c0-18.472-15.028-33.5-33.5-33.5zm-128.393 172.5 145.64-145.64c.798 2.064 1.253 4.298 1.253 6.64v278c0 2.342-.455 4.576-1.253 6.64zm128.393-157.5c2.342 0 4.576.455 6.64 1.253l-167.32 167.32c-17.545 17.547-46.094 17.547-63.64 0l-167.32-167.32c2.064-.798 4.298-1.253 6.64-1.253zm-385 315c-2.342 0-4.576-.455-6.64-1.253l145.64-145.64 11.074 11.074c11.697 11.696 27.062 17.545 42.427 17.545s30.729-5.849 42.426-17.545l11.074-11.074 145.64 145.64c-2.064.798-4.298 1.253-6.64 1.253z"/><path d="m67.5 218.5c-4.142 0-7.5 3.357-7.5 7.5v22.5h-52.5c-4.142 0-7.5 3.357-7.5 7.5s3.358 7.5 7.5 7.5h120c4.142 0 7.5-3.357 7.5-7.5s-3.358-7.5-7.5-7.5h-52.5v-22.5c0-4.143-3.358-7.5-7.5-7.5z"/><path d="m97.5 323.5c4.142 0 7.5-3.357 7.5-7.5s-3.358-7.5-7.5-7.5h-22.5v-22.5c0-4.143-3.358-7.5-7.5-7.5s-7.5 3.357-7.5 7.5v22.5h-52.5c-4.142 0-7.5 3.357-7.5 7.5s3.358 7.5 7.5 7.5z"/></svg>
                                            </div>
                                        </div>
                                    </div>
                                </ng-template>

                                <ng-template #receiverTemplate>
                                    <div class="row msg_cotainer_send">
                                        {{message.content}}
                                        <div class="time_info mt-2 row">
                                            <div class="col-md-4">
                                            </div>
                                            <div matTooltip="Delivered: {{message.timestamp | date:'shortTime'}}" class="col-md-2">
                                                <svg height="20" viewBox="0 -126 512 512" width="20" xmlns="http://www.w3.org/2000/svg"><path d="m333.429688 40.46875c-2.628907 0-5.210938 1.070312-7.070313 2.929688-1.871094 1.863281-2.929687 4.441406-2.929687 7.070312 0 2.632812 1.070312 5.210938 2.929687 7.070312 1.859375 1.859376 4.441406 2.929688 7.070313 2.929688 2.628906 0 5.210937-1.070312 7.070312-2.929688 1.859375-1.859374 2.929688-4.4375 2.929688-7.070312 0-2.628906-1.070313-5.207031-2.929688-7.070312-1.859375-1.859376-4.441406-2.929688-7.070312-2.929688zm0 0"/><path d="m486.210938 0h-314.210938c-14.070312 0-25.539062 11.328125-25.777344 25.34375-8.476562-1.753906-17.335937-.765625-25.410156 3.015625l-52.8125 24.714844v-.824219c0-5.523438-4.476562-10-10-10h-48c-5.523438 0-10 4.476562-10 10s4.476562 10 10 10h38v140h-38c-5.523438 0-10 4.476562-10 10s4.476562 10 10 10h48c5.523438 0 10-4.476562 10-10v-6h56.980469c7.179687 0 14.394531-1.191406 21.230469-3.464844v31.425782c0 14.21875 11.570312 25.789062 25.789062 25.789062h117.105469c5.523437 0 10-4.476562 10-10s-4.476563-10-10-10h-88.710938l38.054688-38.054688c.761719.1875 1.558593.296876 2.378906.296876h100.171875c5.523438 0 10-4.476563 10-10 0-5.523438-4.476562-10-10-10h-82.847656l58.144531-58.144532c3.421875-3.421875 7.96875-5.308594 12.808594-5.308594 4.839843 0 9.386719 1.886719 12.808593 5.308594l115.902344 115.902344h-88.710937c-5.523438 0-10 4.476562-10 10s4.476562 10 10 10h117.105469c14.21875 0 25.789062-11.570312 25.789062-25.789062v-208.421876c0-14.21875-11.570312-25.789062-25.789062-25.789062zm-361.230469 186.25h-56.980469v-111.09375l61.292969-28.683594c5.398437-2.527344 11.492187-2.613281 16.917969-.277344v76.667969l-6.316407 1.382813c-5.398437 1.183594-8.808593 6.515625-7.628906 11.910156 1.183594 5.398438 6.519531 8.808594 11.910156 7.625l48.507813-10.632812c3.207031-.703126 6.480468-.09375 9.214844 1.722656 2.738281 1.816406 4.574218 4.59375 5.171874 7.820312.996094 5.367188-1.757812 10.738282-6.699218 13.0625l-55.304688 26.007813c-6.242187 2.9375-13.1875 4.488281-20.085937 4.488281zm47.019531 53.75c-3.191406 0-5.789062-2.597656-5.789062-5.789062v-40.289063l42.667968-20.070313c13.167969-6.1875 20.507813-20.503906 17.855469-34.808593-1.597656-8.601563-6.492187-16-13.78125-20.835938-7.289063-4.839843-16.011719-6.472656-24.554687-4.59375l-22.1875 4.863281v-88.292968l107.855468 107.855468-100.992187 100.996094c-.304688.304688-.578125.628906-.835938.964844zm157.105469-141.210938c-10.179688 0-19.753907 3.96875-26.949219 11.164063l-13.945312 13.945313-103.898438-103.898438h289.585938l-20.46875 20.46875h-80c-5.523438 0-10 4.476562-10 10s4.476562 10 10 10h60l-63.429688 63.429688-13.945312-13.945313c-7.199219-7.195313-16.769532-11.164063-26.949219-11.164063zm157.105469 141.210938h-.238282c-.257812-.332031-.53125-.660156-.835937-.964844l-100.992188-100.996094 107.855469-107.855468v204.027344c0 3.191406-2.597656 5.789062-5.789062 5.789062zm0 0"/><path d="m329.398438 240c-2.636719 0-5.207032 1.070312-7.078126 2.929688-1.859374 1.859374-2.929687 4.441406-2.929687 7.070312s1.070313 5.210938 2.929687 7.070312c1.871094 1.859376 4.441407 2.929688 7.078126 2.929688 2.632812 0 5.203124-1.070312 7.070312-2.929688 1.859375-1.859374 2.921875-4.441406 2.921875-7.070312s-1.0625-5.210938-2.921875-7.070312c-1.867188-1.859376-4.4375-2.929688-7.070312-2.929688zm0 0"/></svg>                                                </div>
                                        </div>
                                    </div>

                                    <div class="img_cont_msg">
                                        <img src="{{message.senderAvatarUrl}}" class="rounded-circle user_img_msg">
                                    </div>

                                </ng-template>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="modal-footer justify-content-center">

                <div class="input-group">

                    <div class="input-group-append">
                        <span class="input-group-text attach_btn"><i class="fas fa-paperclip"></i></span>
                    </div>

                    <textarea [(ngModel)]="messageToSend" (keyup)="$event.keyCode == 13 ? sendMessage() : null" class="form-control type_msg" placeholder="Type your message... "></textarea>

                    <div class="input-group-append">
                        <span (click)="sendMessage()" class="input-group-text send_btn"><i class="fas fa-location-arrow"></i></span>
                    </div>

                </div>
            </div>
        </div>
    </div>
</div>